<div class="booking-screen">
    <div class="body-relative relative">
        <div class="top-navigator">
            <span>Đặt lịch giữ chỗ</span>
        </div>
        <div class="main-screen">
            <div class="main-screen__block main-screen__block--active">
                <div class="first-item"></div>
                <div class="title-header__booking">
                    1. Chọn salon
                </div>
                <div class="bot-message">
                    <img src="https://30shine.com/static/media/bot_avatar_1654_1.26e1da41.jpg" alt="">
                    <div class="content-message">
                        <p>
                            Đầu tiên anh {{{name}}} chọn "Tìm salon gần anh" ở ngay bên dưới để tìm Salon
                            thuận tiện nhất nhé!
                        </p>
                    </div>
                </div>
                <div class="item-center">
                    <div class="salon-icon">
                        <img src="https://30shine.com/static/media/homeOutline.76facfa5.svg" alt="">
                        <div class="salon-icon--active">
                            <div class="salon-icon--active__iner"></div>
                            <div class="salon-icon--active__outner"></div>
                        </div>
                    </div>

                    <div class="salon-title">
                        {{{street}}}
                    </div>

                    <div class="salon-icon--right">
                        <img src="https://30shine.com/static/media/caretRight.b0d191b3.svg" alt="">
                    </div>
                </div>
                <div class="text-validate">Anh vui lòng chọn salon trước để xem lịch còn trống ạ!</div>
            </div>
            <div class="main-screen__block">
                <div class="title-header__booking">
                    2. Chọn dịch vụ
                </div>
                <div class="bot-message">
                    <img src="https://30shine.com/static/media/bot_avatar_1654_1.26e1da41.jpg" alt="">
                    <div class="content-message">
                        <p>
                            Anh {{{name}}} chọn trước dịch vụ bên dưới để chúng em chuẩn bị chu đáo ạ
                        </p>
                    </div>
                </div>
                <div class="item-center">
                    <div class="salon-icon">
                        <img src="https://30shine.com/static/media/service.3a62b101.svg" alt="">
                        <div class="salon-icon--active">
                            <div class="salon-icon--active__iner"></div>
                            <div class="salon-icon--active__outner"></div>
                        </div>
                    </div>
                    <div class="salon-title service-title">
                        {{lengthService}}
                    </div>
                    <div class="salon-icon--right">
                        <img src="https://30shine.com/static/media/caretRight.b0d191b3.svg" alt="">
                    </div>
                </div>
                <div class="text-validate">Mời anh chọn dịch vụ để có stylist và giờ cắt phù hợp ạ!</div>
                <div class="block-box">
                    {{#if isHaveName}}
                    <div class="mt-4">
                        <div style="display:flex;flex-wrap: wrap;margin-left: -0.375rem;margin-right: -0.375rem;">
                            {{#each nameServiceBooked}}
                            <div class="name-service__booked">
                                {{this}}
                            </div>
                            {{/each}}
                        </div>
                    </div>
                    {{/if}}
                </div>
            </div>
            <div class="main-screen__block">
                <div class="title-header__booking">
                    3. Chọn ngày, giờ & stylist
                </div>
                <div class="bot-message">
                    <img src="https://30shine.com/static/media/bot_avatar_1654_1.26e1da41.jpg" alt="">
                    <div class="content-message">
                        <p>
                            Anh {{{name}}} chọn Stylist riêng cho mình ạ
                        </p>
                    </div>
                </div>
                <div class="style-list dis-none" id="style-list">
                    <div class="style-list__dropdown pointer flex">
                        <span class="flex">
                            <img src="https://30shine.com/static/media/user-large.69c611a8.svg" alt="">
                        </span>
                        <span>Chọn Stylist</span>
                        <span class="flex item-center" style="background-color: transparent;">
                            <img class="img-drop" src="https://30shine.com/static/media/chevronRight.fe25caf9.svg"
                                alt="">
                        </span>
                    </div>

                    <div class="content hide-stylist">
                        {{!-- <div class="left isActive">
                            <div>
                                <div class="user-default relative pointer">
                                    <img src="https://30shine.com/static/media/account_circle%20-%20yellow.d917c981.svg"
                                        alt="" class="img-user">
                                    <img src="https://30shine.com/static/media/checkYellow.02dbd103.svg" alt=""
                                        class="icon-check-default">
                                </div>
                            </div>

                            <div>
                                <span>
                                    30 shine
                                    <br>Chọn Hộ Anh
                                </span>
                            </div>
                        </div> --}}

                    </div>
                </div>

                <div class="block-box date-drop mt-2">
                    <div class="relative">
                        <div class="item-center">
                            <div class="salon-icon">
                                <img src="https://30shine.com/static/media/calendar-2.3c77d299.svg" alt="">
                                <div class="salon-icon--active">
                                    <div class="salon-icon--active__iner"></div>
                                    <div class="salon-icon--active__outner"></div>
                                </div>
                            </div>
                            <div class="salon-title__item">
                                <div class="salon-title__item--center">
                                </div>

                            </div>
                            <div class="salon-icon--right">
                                <img class="date-drop__icon"
                                    src="https://30shine.com/static/media/caretRight.b0d191b3.svg" alt="">
                            </div>
                        </div>

                        <div class="drop-shadow drop-date opacity-0">
                        </div>
                    </div>
                </div>
                <div class="box-time" id="box-time">
                    <div class="relative">
                        <div class="swiper-container">
                            <div class="swiper-wrapper swiper__shift">


                            </div>


                        </div>
                        <div class="swiper-button-prev swiper__button dis-none">
                            <span class="swiper_button__icon">
                                <svg viewBox="64 64 896 896" focusable="false" class="" data-icon="left" width="1em"
                                    height="1em" fill="currentColor" aria-hidden="true">
                                    <path
                                        d="M724 218.3V141c0-6.7-7.7-10.4-12.9-6.3L260.3 486.8a31.86 31.86 0 000 50.3l450.8 352.1c5.3 4.1 12.9.4 12.9-6.3v-77.3c0-4.9-2.3-9.6-6.1-12.6l-360-281 360-281.1c3.8-3 6.1-7.7 6.1-12.6z">
                                    </path>
                                </svg>
                            </span>
                        </div>
                        <div class="swiper-button-next swiper__button dis-none">
                            <span class="swiper_button__icon">
                                <svg viewBox="64 64 896 896" focusable="false" class="" data-icon="right" width="1em"
                                    height="1em" fill="currentColor" aria-hidden="true">
                                    <path
                                        d="M765.7 486.8L314.9 134.7A7.97 7.97 0 00302 141v77.3c0 4.9 2.3 9.6 6.1 12.6l360 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6.7 7.7 10.4 12.9 6.3l450.8-352.1a31.96 31.96 0 000-50.4z">
                                    </path>
                                </svg>

                            </span>
                        </div>
                    </div>
                </div>
                <div style="height:50px"></div>
            </div>
            <div class="new-affix-v2">
                <div class="content-step time-line space-between flex text-center">
                    <div class="button-finally btn-inactive pointer">
                        <span>Hoàn tất</span>
                    </div>
                    <span class="sub-description">Cắt xong trả tiền, hủy lịch không sao</span>
                </div>

            </div>


        </div>

    </div>
</div>



<form id="chooseStore" action="/booking/?phone={{_user.phoneUser}}&storeId=0&step=1" method="POST"></form>
<form method="POST" id="book" style="display: none">

</form>
<script>
    const itemCenter = document.querySelectorAll('.item-center');
    const formChooseStore = document.getElementById('chooseStore');
    const urlBook = window.location.href;
    const arrUrl = urlBook.split("&");
    const mainScrActive = document.querySelector('.main-screen__block--active');
    const mainScr = document.querySelectorAll('.main-screen__block');
    const iconActive = document.querySelectorAll('.salon-icon--active');
    const botMessage = document.querySelectorAll('.bot-message');
    const textValidate = document.querySelectorAll('.text-validate');
    const serviceTitle = document.querySelector('.service-title');
    const salonTitle = document.querySelector('.salon-title');
    var styList = document.querySelector('.style-list');
    var shift = {{{ shiftParse }}};
    var staffsInDate1 = {{{ staffsInDate1 }}};
    var staffsInDate2 = {{{ staffsInDate2 }}};
    var staffsInDate3 = {{{ staffsInDate3 }}};
    var staffsInDate4 = {{{ staffsInDate4 }}};
    var staffsInDate5 = {{{ staffsInDate5 }}};
    var staffsInDate6 = {{{ staffsInDate6 }}};
    var bookedInDate1 = {{{ bookedInDate1 }}};
    var bookedInDate2 = {{{ bookedInDate2 }}};
    var bookedInDate3 = {{{ bookedInDate3 }}};
    var bookedInDate4 = {{{ bookedInDate4 }}};
    var bookedInDate5 = {{{ bookedInDate5 }}};
    var bookedInDate6 = {{{ bookedInDate6 }}};
    const shiftSwiper = document.querySelector('.swiper__shift');
    itemCenter[0].addEventListener('click', () => {
        formChooseStore.action = `${arrUrl[0]}&${arrUrl[1]}&step=1`;
        formChooseStore.submit();
    })
    if (arrUrl[1] !== 'storeId=0') {
        iconActive[0].style.display = 'none';
        botMessage[0].style.display = 'none';
        salonTitle.style.color = '#111';

        if (serviceTitle.innerHTML.trim() == 'Xem tất cả dịch vụ hấp dẫn') {
            mainScr[1].classList.add('main-screen__block--active');
            mainScr[0].classList.add('main-screen__block--done');
            mainScr[0].classList.remove('main-screen__block--active');
            iconActive[1].style.display = 'flex';
            botMessage[1].style.display = 'flex';
            serviceTitle.style.color = '#a3a3a3';
        } else {
            mainScr[0].classList.add('main-screen__block--done');
            mainScr[0].classList.remove('main-screen__block--active');
            mainScr[2].classList.add('main-screen__block--active');
            mainScr[1].classList.add('main-screen__block--done');
            mainScr[1].classList.remove('main-screen__block--active');
            iconActive[1].style.display = 'none';
            iconActive[2].style.display = 'flex';
            botMessage[1].style.display = 'none';
            botMessage[2].style.display = 'flex';
            serviceTitle.style.color = '#111';
        }
    } else if (arrUrl[1] === 'storeId=0') {
        botMessage[0].style.display = 'flex';
        iconActive[0].style.display = 'flex';
        salonTitle.style.color = '#a3a3a3';
    }

    itemCenter[1].addEventListener('click', () => {
        if (arrUrl[1] === 'storeId=0') {
            textValidate[0].style.color = '#f46969';
            textValidate[0].style.display = 'block';
            itemCenter[0].style.borderColor = '#f46969';
            itemCenter[0].style.borderWidth = '1px';
            itemCenter[0].style.borderStyle = 'solid';
        } else {
            formChooseStore.action = `${arrUrl[0]}&${arrUrl[1]}&step=2`;
            formChooseStore.submit();
        }
    })
    itemCenter[2].addEventListener('click', () => {
        if (arrUrl[1] === 'storeId=0') {
            textValidate[0].style.color = '#f46969';
            textValidate[0].style.display = 'block';
            itemCenter[0].style.borderColor = '#f46969';
            itemCenter[0].style.borderWidth = '1px';
            itemCenter[0].style.borderStyle = 'solid';
        } else {
            if (serviceTitle.innerHTML.trim() == 'Xem tất cả dịch vụ hấp dẫn') {
                textValidate[1].style.color = '#f46969';
                textValidate[1].style.display = 'block';
                itemCenter[1].style.borderColor = '#f46969';
                itemCenter[1].style.borderWidth = '1px';
                itemCenter[1].style.borderStyle = 'solid';
            }
        }
    })
    itemCenter[3].addEventListener('click', () => {
        if (arrUrl[1] === 'storeId=0') {
            textValidate[0].style.color = '#f46969';
            textValidate[0].style.display = 'block';
            itemCenter[0].style.borderColor = '#f46969';
            itemCenter[0].style.borderWidth = '1px';
            itemCenter[0].style.borderStyle = 'solid';
        }
        else {
            if (serviceTitle.innerHTML.trim() == 'Xem tất cả dịch vụ hấp dẫn') {
                textValidate[1].style.color = '#f46969';
                textValidate[1].style.display = 'block';
                itemCenter[1].style.borderColor = '#f46969';
                itemCenter[1].style.borderWidth = '1px';
                itemCenter[1].style.borderStyle = 'solid';
            }
            else {
                clickdateDrop();
            }
        }
    })


    // render box time

    if (serviceTitle.innerHTML.trim() != 'Xem tất cả dịch vụ hấp dẫn') {
        styList.classList.remove('dis-none');
        renderBoxTime();
        checkTimeNow();
    }


    // dropdown stylist

    const styDrop = document.querySelector('.style-list__dropdown');
    const contentStaff = document.querySelector('.content');
    const imgDrop = document.querySelector('.style-list__dropdown .img-drop');
    var staffCurrent;
    var bookedInDateCurrent;
    styDrop.onclick = () => {
        if (contentStaff.classList.contains('fade-in')) {
            contentStaff.classList.add('hide-stylist');
            contentStaff.classList.remove('fade-in');
            imgDrop.src = 'https://30shine.com/static/media/chevronRight.fe25caf9.svg';
        } else {
            contentStaff.classList.remove('hide-stylist');
            contentStaff.classList.add('fade-in');
            imgDrop.src = 'https://30shine.com/static/media/chevronDown.4843aae8.svg';
            var staffItem = document.querySelectorAll('.left');
            if (typeof staffCurrent === 'undefined') {
                clickStaffItem(staffItem, staffsInDate1, bookedInDate1);
            }
            else {
                clickStaffItem(staffItem, staffCurrent, bookedInDateCurrent);
            }
        }
    }

    // drop-down date 

    const dateDrop = document.querySelector('.date-drop');
    const dropDate = document.querySelector('.drop-date');
    const dateItemCenter = document.querySelector('.salon-title__item--center');
    const dropIconDate = document.querySelector('.date-drop__icon');
    var date = new Date();
    var dayOfWeek = date.getDay();
    var dayCurrent = date.getDate();
    var monthCurrent = date.getMonth() + 1;
    var yearCurrent = date.getYear();
    dropDate.innerHTML = '';
    var boxTimeItemAll = document.querySelectorAll('.box-time__item');

    var staffChoose;
    var shiftChoose;
    var dateChoose;
    if (staffsInDate1.length > 0) dateChoose = staffsInDate1[0].DateRegis;


    // render date center

    dateItemCenter.innerHTML = `
                                        <span>Hôm nay,
                                    </span>
                                    <span>
                                        ${nameDayOfWeek(dayOfWeek)}
                                        (${dayCurrent}/${monthCurrent})
                                    </span>
    `;

    function nameDayOfWeek(number) {
        switch (number) {
            case 0: return 'CN';
            case 1: return 'T2';
            case 2: return 'T3';
            case 3: return 'T4';
            case 4: return 'T5';
            case 5: return 'T6';
            case 6: return 'T7';
        }
    }

    function nameDay(number) {
        switch (number) {
            case 0: return 'Hôm nay,';
            case 1: return 'Ngày mai,';
            case 2: return 'Ngày kia,';
            case 3: return '';
            case 4: return '';
            case 5: return '';
        }
    }

    // check leap year
    function leapYear(year) {
        return ((year % 4 == 0) && (year % 100 != 0)) || (year % 400 == 0);
    }
    var dropItem = '';
    var isClick = false;
    function clickdateDrop() {
        dateDrop.onclick = () => {

        }
        if (!dropDate.classList.contains('opacity-1')) {
            dropDate.classList.add('opacity-1');
            dropDate.classList.add('fade-in');
            dropIconDate.src = 'https://30shine.com/static/media/caretDown.9392e204.svg';
            date = new Date();
            if (isClick) {
                dropDate.innerHTML = dropItem;
            }
            else {
                for (var i = 0; i < 6; i++) {
                    dropItem += `
                <div class="drop-date__item pointer">
                                <div style="width:35px"></div>
                                <div>
                                    <span>${nameDay(i)}
                                    </span>
                                    <span>
                                        ${nameDayOfWeek(dayOfWeek)}
                                        (${dayCurrent}/${monthCurrent})
                                    </span>

                                </div>
                            </div>
                `
                    // handle day of week
                    if (dayOfWeek == 6) dayOfWeek = 0;
                    else {
                        dayOfWeek++;
                    }
                    // handle day of month
                    if (leapYear(yearCurrent)) {
                        if (dayCurrent == 29 && monthCurrent == 2) {
                            dayCurrent = 0;
                            monthCurrent++;

                        }
                        if (dayCurrent == 30) {
                            if (monthCurrent == 4 || monthCurrent == 6 || monthCurrent == 9 || monthCurrent == 11) {
                                dayCurrent = 0;
                                monthCurrent++;
                            }

                        }
                        if (dayCurrent == 31) {
                            if (monthCurrent === 1 || monthCurrent == 3 || monthCurrent == 5 || monthCurrent == 7
                                || monthCurrent == 8 || monthCurrent == 10 || monthCurrent == 12) {
                                dayCurrent = 0;
                                monthCurrent++;
                            }
                        }
                    }
                    else {
                        if (dayCurrent == 28 && monthCurrent == 2) {
                            dayCurrent = 0;
                            monthCurrent++;

                        }
                        if (dayCurrent == 30) {
                            if (monthCurrent == 4 || monthCurrent == 6 || monthCurrent == 9 || monthCurrent == 11) {
                                dayCurrent = 0;
                                monthCurrent++;
                            }
                        }
                        if (dayCurrent == 31) {
                            if (monthCurrent === 1 || monthCurrent == 3 || monthCurrent == 5 || monthCurrent == 7
                                || monthCurrent == 8 || monthCurrent == 10 || monthCurrent == 12) {
                                dayCurrent = 0;
                                monthCurrent++;
                            }
                        }
                    }
                    dayCurrent++;
                }
                dropDate.innerHTML = dropItem;
                isClick = true;

            }
        } else {
            dropDate.classList.remove('opacity-1');
            dropDate.classList.remove('fade-in');
            dropDate.innerHTML = '';
            dropIconDate.src = 'https://30shine.com/static/media/caretRight.b0d191b3.svg';
        }
        let dropDateItem = document.querySelectorAll('.drop-date__item');
        dropDateItem.forEach((item, index) => {
            item.onclick = () => {
                if (index == 0) {
                    if (staffsInDate1.length > 0)
                        dateChoose = staffsInDate1[0].DateRegis;
                    dateItemCenter.innerHTML = item.innerHTML;
                    renderBoxTime();
                    checkTimeNow();
                    var boxTimeItem = document.querySelectorAll('.box-time__item');
                    clickBoxItem(boxTimeItem);
                    renderStaffInDate(staffsInDate1);
                    var staffItem = document.querySelectorAll('.left');
                    clickStaffItem(staffItem, staffsInDate1, bookedInDate1);
                } else {
                    renderBoxTime();
                    switch (index) {
                        case 1:
                            staffCurrent = staffsInDate2;
                            bookedInDateCurrent = bookedInDate2;
                            if (staffsInDate2.length > 0)
                                dateChoose = staffsInDate2[0].DateRegis;
                            renderStaffInDate(staffsInDate2);
                            unvaliableTimeBooked(bookedInDate2, staffsInDate2[0].IDStaff);
                            var boxTimeItem = document.querySelectorAll('.box-time__item');
                            clickBoxItem(boxTimeItem);
                            var staffItem = document.querySelectorAll('.left');
                            clickStaffItem(staffItem, staffsInDate2, bookedInDate2);
                            break;
                        case 2:
                            staffCurrent = staffsInDate3;
                            bookedInDateCurrent = bookedInDate3;
                            if (staffsInDate3.length > 0)
                                dateChoose = staffsInDate3[0].DateRegis;
                            renderStaffInDate(staffsInDate3);
                            unvaliableTimeBooked(bookedInDate3, staffsInDate2[0].IDStaff);
                            var boxTimeItem = document.querySelectorAll('.box-time__item');
                            clickBoxItem(boxTimeItem);
                            var staffItem = document.querySelectorAll('.left');
                            clickStaffItem(staffItem, staffsInDate3, bookedInDate3);
                            break;
                        case 3:
                            staffCurrent = staffsInDate4;
                            bookedInDateCurrent = bookedInDate4;
                            if (staffsInDate4.length > 0)
                                dateChoose = staffsInDate4[0].DateRegis;
                            renderStaffInDate(staffsInDate4);
                            unvaliableTimeBooked(bookedInDate4, staffsInDate2[0].IDStaff);
                            var boxTimeItem = document.querySelectorAll('.box-time__item');
                            clickBoxItem(boxTimeItem);
                            var staffItem = document.querySelectorAll('.left');
                            clickStaffItem(staffItem, staffsInDate4, bookedInDate4);
                            break;
                        case 4:
                            staffCurrent = staffsInDate5;
                            bookedInDateCurrent = bookedInDate5;
                            if (staffsInDate5.length > 0)
                                dateChoose = staffsInDate5[0].DateRegis;
                            renderStaffInDate(staffsInDate5);
                            unvaliableTimeBooked(bookedInDate5, staffsInDate2[0].IDStaff);
                            var boxTimeItem = document.querySelectorAll('.box-time__item');
                            clickBoxItem(boxTimeItem);
                            var staffItem = document.querySelectorAll('.left');
                            clickStaffItem(staffItem, staffsInDate5, bookedInDate5);
                            break;
                        case 5:
                            staffCurrent = staffsInDate6;
                            bookedInDateCurrent = bookedInDate6;
                            if (staffsInDate6.length > 0)
                                dateChoose = staffsInDate6[0].DateRegis;
                            renderStaffInDate(staffsInDate6);
                            unvaliableTimeBooked(bookedInDate6, staffsInDate2[0].IDStaff);
                            var boxTimeItem = document.querySelectorAll('.box-time__item');
                            clickBoxItem(boxTimeItem);
                            var staffItem = document.querySelectorAll('.left');
                            clickStaffItem(staffItem, staffsInDate6, bookedInDate6);
                            break;
                    }
                    dateItemCenter.innerHTML = item.innerHTML;
                }
            }
        })
    }

    // handle box-time
    var shiftHtml = ``;
    function returnMinuteFormat(number) {
        if (number == 0) return '00';
        else return number;
    }
    function renderBoxTime() {
        shiftHtml = ``;
        for (var i = 0; i < shift.length;) {
            shiftHtml += `
        <div class="swiper-slide" style="width: 101.048px !important;">
            <div class="box-time__item">${shift[i].HourStart}h${returnMinuteFormat(shift[i].MinuteStart)}</div> 
            <div class="box-time__item">${shift[++i].HourStart}h${returnMinuteFormat(shift[i].MinuteStart)}</div>
            <div class="box-time__item">${shift[++i].HourStart}h${returnMinuteFormat(shift[i].MinuteStart)}</div>
        </div>
        `
            i++;
        }
        shiftSwiper.innerHTML = shiftHtml;
        var swiperBtn = document.querySelectorAll('.swiper__button')
        swiperBtn[0].classList.remove('dis-none')
        swiperBtn[1].classList.remove('dis-none')
    }
    //renderBoxTime();
    //checkTimeNow();
    function checkTimeNow() {
        var d = new Date();
        var boxTimeItem = document.querySelectorAll('.box-time__item');
        var hour = d.getHours();
        var minute = d.getMinutes();
        shift.forEach((item, index) => {
            if (hour >= item.HourStart) {
                boxTimeItem[index].classList.add('unvaliable');
            } else {
                if (item.HourStart - hour == 1) {
                    if (minute - item.MinuteStart > 30) {
                        boxTimeItem[index].classList.add('unvaliable');
                    }
                }
            }
        })
        if (staffsInDate1.length > 0 && bookedInDate1.length > 0)
            unvaliableTimeBooked(bookedInDate1, staffsInDate1[0].IDStaff);
    }

    var isClickStaff = false;
    function unvaliableTimeBooked(bookInDate, idStaff) {
        var boxTimeItem = document.querySelectorAll('.box-time__item');
        bookInDate.forEach((item) => {
            if (item.IDStaff == idStaff) {
                boxTimeItem[item.IDShiftBook - 1].classList.add('unvaliable');
            }
        })

    }
    var boxTimeItemCurrent = document.querySelectorAll('.box-time__item');
    var btnFinally = document.querySelector('.button-finally');
    clickBoxItem(boxTimeItemCurrent);
    function clickBoxItem(boxTimeItem) {
        var indexPre = -1
        boxTimeItem.forEach((item, index) => {
            if (!item.classList.contains('unvaliable')) {
                item.onclick = () => {
                    isClickTime = true;
                    if (indexPre >= 0) boxTimeItem[indexPre].classList.remove('has-choice');
                    item.classList.add('has-choice');
                    shiftChoose = index + 1;
                    indexPre = index;
                    if (isClickStaff)
                        btnFinally.classList.remove('btn-inactive');
                }
            }
        })
    }


    function removeAllUnvaliable() {
        var boxTimeItem = document.querySelectorAll('.box-time__item');
        boxTimeItem.forEach((item, index) => {
            item.classList.remove('unvaliable');
            item.classList.remove('has-choice')
        })
    }

    // render staff follow date
    function renderStaffInDate(staffItem) {
        var staffList = document.querySelector('.content');
        var html = ``;
        if (staffItem.length == 0) {
            contentStaff.classList.add('hide-stylist');
            contentStaff.classList.remove('fade-in');
            imgDrop.src = 'https://30shine.com/static/media/chevronRight.fe25caf9.svg';
        }
        for (var i = 0; i < staffItem.length; i++) {
            html += `
            <div class="left">
    <div>
        <div class="user-default relative pointer">
            
            <img src="${staffItem[i].PathImgStaff}" alt="" class="img-user" style="width: 70px; height: 70px; border-radius: 50px; border: 2px solid #fff;" />
        </div>
    </div>

    <div>
        <span>
            ${staffItem[i].SurName}
            <br />
            ${staffItem[i].NameStaff}
        </span>
    </div>
</div>
            `
        }
        staffList.innerHTML = html;
    }

    function clickStaffItem(staffItem, staffInDate, bookedInDate) {
        var indexPre = -1;
        var staffImg = document.querySelectorAll('.user-default');
        var html = ``;
        var htmlPre = ``;
        staffItem.forEach((item, index) => {
            item.onclick = () => {
                isClickStaff = true;
                btnFinally.classList.add('btn-inactive');
                renderBoxTime();
                if (staffInDate == staffsInDate1) checkTimeNow();
                if (staffInDate.length > 0) {
                    unvaliableTimeBooked(bookedInDate, staffInDate[index].IDStaff);
                    staffChoose = staffInDate[index].IDStaff;
                    html = staffImg[index].innerHTML;
                    if (indexPre >= 0) {
                        staffItem[indexPre].classList.remove('isActive');
                        staffImg[indexPre].innerHTML = htmlPre;
                    }
                    htmlPre = staffImg[index].innerHTML;
                    html += `  <img class="icon-check-default" src="https://30shine.com/static/media/checkYellow.02dbd103.svg"/>`
                    staffImg[index].innerHTML = html;
                    item.classList.add('isActive');
                    indexPre = index;
                }
                var boxTimeItem = document.querySelectorAll('.box-time__item');
                clickBoxItem(boxTimeItem);
            }
        })
    }


    const formBook = document.getElementById('book');
    var serviceBooked = {{{ serviceBooked }}}
    function totalPayment() {
        var payment = 0;
        for (var i = 0; i < serviceBooked.length; i++) {
            payment += serviceBooked[i][0].ListPrice;
        }
        return payment;

    }
    totalPayment();
    btnFinally.onclick = () => {
        var html = ``;
        var phoneBook = arrUrl[0].split('phone=');
        var storeBook = arrUrl[1].split('=');
        var payment = totalPayment();
        if (!btnFinally.classList.contains('btn-inactive')) {
            html += `<input value="${shiftChoose}" name="idShiftBook">`;
            html += `<input value="${dateChoose}" name="dateBook">`;
            html += `<input value="${phoneBook[1]}" name="phoneBook">`;
            html += `<input value="${storeBook[1]}" name="storeBook">`;
            html += `<input value="${staffChoose}" name="staffBook">`;
            html += `<input value="${payment}" name="payment">`;
            if (serviceBooked.length > 0) {
                for (var i = 0; i < serviceBooked.length; i++) {
                    html += `<input value="${serviceBooked[i][0].IDService}" name="servicesBook[]">`;
                }
            }
            formBook.innerHTML = html;
            formBook.action = `${arrUrl[0]}&${arrUrl[1]}&step=3`;
            formBook.submit();
        }
    }
    renderStaffInDate(staffsInDate1);

</script>


<script src="https://unpkg.com/swiper/swiper-bundle.min.js"></script>
<script>
    var swiper = new Swiper('.swiper-container', {
        slidesPerView: 1,
        spaceBetween: 10,
        pagination: {
            el: '.swiper-pagination',
            clickable: true,
        },
        navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev'
        },
        slidesPerView: "auto",
        slidesBetween: "auto",
    });
</script>